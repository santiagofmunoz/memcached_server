# memcached_server

## Introduction

This is an implentation of a memcached server based on the coding challenge by Moove-It. The application is written in Ruby and it doesn't use anyother external gem apart from the ones included in the standard installation of Ruby.

## Implemented Methods

### Storage Commands

- Set
- Add
- Replace
- Append
- Prepend
- Cas

### Retrieval Commands

- Get
- Gets

### Issues solved

- Purge expired keys.
- Management of multiple clients.

## Installation

Clone or download this repository to any directory you want in your computer. After that, you have to open a Terminal/Cmd (depending on your OS) where you cloned the repository and run ```ruby startServer.rb```

The software was created and tested in this environment and due to this, it's the recommended environment to run it:

- OS: Ubuntu 20.04 LTS (Focal Fossa) 64-bit.
- Ruby 2.7.0 (obtained via [RVM](https://rvm.io/))

Nonetheless, it should work in other OSes and higher versions of Ruby. Feel free to let me know if it doesn't.

## How to use it

This is an implementation of a TCP Server, so, in order to use it, you'll need a TCP Client.

Any TCP Client can be used, but if you don't want to search or implement a TCP Client you can use it by writing ```telnet [IP_Address] [Port]``` in any Terminal/Cmd (or the equivalent command depending on your OS). By the default, the software uses localhost (```127.0.0.1```) as IP Address and ```11211``` as Port (This specific port is the same used by Memcached).

After that, you can issue any command you want. As requested by the challenge, I've followed [Memcached's protocol](https://github.com/memcached/memcached/blob/master/doc/protocol.txt) to write the commands for this software.

Here's a quick view on how to write the commands.

### Commands Usage

#### Storage Commands

```<command name> <key> <flags> <exptime> <bytes>```

- ```<command name>```: The command that you want to execute (i.e ```set```, ```add```, ```replace```, etc)
- ```<key>``` : Identification of the value that you want to save (It can be a number, a word, but it can't have whitespaces).
- ```<flags>```: "Is an arbitrary 16-bit unsigned integer (written out in decimal) that the server stores along with the data and sends back when the item is retrieved. Clients may use this as a bit field to store data-specific information" [Citation from Memcached's protocol](https://github.com/memcached/memcached/blob/82029ecc9b3dd0f57b3f9ab9761f44714cceed6f/doc/protocol.txt#L225)
- ```<exptime>```: Expiration time of the stored entry. It can be written in seconds or in UNIX Time.
- ```<bytes>```: Size in bytes (Number) of the value that will be stored. If the value is bigger than the size specified, the object won't be saved.

The command cas has a slightly change on its structure.

```cas <key> <flags> <exptime> <bytes> <cas unique>```

- ```<cas unique>```: Is a unique value generated by the server for a specific entry

After writing the desired command, the data block should be written.

##### Sample commands

```
set a1 1 10000 8
datatest
```

```
add a2 1 1640995199 9
datatest1
```

```
replace a1 1 20000 9
datatest2
```

```
append a1 1 20000 17
datatest3
```

```
prepend a1 1 20000 17
datatest4
```

```
cas a1 1 20000 9 1
datatest5
```

#### Retrieval Commands

```get <key>```

```gets <key>```

- ```<key>```: Identification of the saved object, it can be one or more strings, separated by whitespace.

##### Sample commands

```get a1```

```gets a1 a2```

## Running the tests

Go to ```tests``` folder in the repository and run ```ruby run_tests.rb```. This will execute all the tests created for the software.

## References

- [Moove-It's code challenge](https://github.com/moove-it/coding-challenges/blob/master/ruby.md)
- [Memcached](https://github.com/memcached/memcached)
- [Memcached protocol](https://github.com/memcached/memcached/blob/master/doc/protocol.txt)
